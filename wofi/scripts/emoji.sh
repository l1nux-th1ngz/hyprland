#!/usr/bin/env bash
#
# EMOJI SELECTOR #
##################

# Exit on error, unset variable as error, and propagate failure in pipelines
set -euo pipefail

# Trap & cleanup previous executions
cleanup() {
    # Kill all remaining processes still running
    killall -9Ieqg $$ >/dev/null 2>&1
    exit 0
}
trap cleanup EXIT

# Function to check if the required tools are installed
requirements() {
    local required_tools=("wofi" "wl-copy" "notify-send")
    local missing_tools=()

    for tool in "${required_tools[@]}"; do
        if ! command -v "$tool" &>/dev/null; then
            missing_tools+=("$tool")
        fi
    done

    if [ ${#missing_tools[@]} -gt 0 ]; then
        notify-send -u critical -a "$0" "Missing tools: ${missing_tools[@]}" ||
        echo "Missing tools: ${missing_tools[@]}" 2>&1
        return 1
    else
        return 0
    fi
}

# Function to handle emoji menu and user input
menu() {
    local list=(
        "😀  :smile:"
        "😃  :smiley:"
        "😄  :grin:"
        "😁  :grinning:"
        "😆  :laughing:"
        "😅  :sweat_smile:"
        "😂  :joy:"
        "🤣  :rofl:"
        "😊  :blush:"
        "😇  :innocent:"
        "🙂  :slightly_smiling_face:"
        "😉  :wink:"
        "😌  :relieved:"
        "😍  :heart_eyes:"
        "🥰  :smiling_face_with_3_hearts:"
        "😘  :kissing_heart:"
        "😗  :kissing:"
        "😙  :kissing_smiling_eyes:"
        "😚  :kissing_closed_eyes:"
        "😋  :yum:"
        "😛  :stuck_out_tongue:"
        "😝  :stuck_out_tongue_closed_eyes:"
        "😜  :stuck_out_tongue_winking_eye:"
        "🤪  :zany_face:"
        "🤨  :face_with_raised_eyebrow:"
        "🧐  :face_with_monocle:"
        "🤓  :nerd_face:"
        "😎  :sunglasses:"
        "🥸  :disguised_face:"
        "🤩  :star_struck:"
        "🥳  :partying_face:"
        "😏  :smirk:"
        "😒  :unamused:"
        "😞  :disappointed:"
        "😔  :pensive:"
        "😟  :worried:"
        "😕  :confused:"
        "🙁  :slightly_frowning_face:"
        "☹️  :frowning_face:"
        "😣  :persevere:"
        "😖  :confounded:"
        "😫  :tired_face:"
        "😩  :weary:"
        "🥺  :pleading_face:"
        "😢  :cry:"
        "😭  :sob:"
        "😤  :triumph:"
        "😠  :angry:"
        "😡  :rage:"
        "🤬  :face_with_symbols_over_mouth:"
        "🤯  :exploding_head:"
        "😳  :flushed:"
        "🥵  :hot_face:"
        "🥶  :cold_face:"
        "😱  :scream:"
        "😨  :fearful:"
        "😰  :cold_sweat:"
        "😥  :disappointed_relieved:"
        "😓  :sweat:"
        "🤗  :hugs:"
        "🤔  :thinking:"
        "🤭  :giggling:"
        "🤫  :shushing_face:"
        "🤥  :lying_face:"
        "😶  :no_mouth:"
        "😐  :neutral_face:"
        "😑  :expressionless:"
        "😬  :grimacing:"
        "🙄  :face_with_rolling_eyes:"
        "😯  :hushed:"
        "😦  :frowning:"
        "😧  :anguished:"
        "😮  :open_mouth:"
        "😲  :astonished:"
        "🥱  :yawning_face:"
        "😴  :sleeping:"
        "🤤  :drooling_face:"
        "😪  :sleepy:"
        "😵  :dizzy_face:"
        "🤐  :zipper_mouth_face:"
        "🥴  :woozy_face:"
        "🤢  :nauseated_face:"
        "🤮  :vomiting_face:"
        "🤧  :sneezing_face:"
        "😷  :mask:"
        "🤒  :thermometer_face:"
        "🤕  :face_with_head_bandage:"
        "🤑  :money_mouth_face:"
        "🤠  :cowboy_hat_face:"
        "🤡  :clown_face:"
        "😈  :smiling_imp:"
        "👿  :imp:"
        "👹  :japanese_ogre:"
        "👺  :japanese_goblin:"
        "💀  :skull:"
        "👻  :ghost:"
        "👽  :alien:"
        "👾  :space_invader:"
        "🤖  :robot:"
        "😺  :smiley_cat:"
        "😸  :smile_cat:"
        "😹  :joy_cat:"
        "😻  :heart_eyes_cat:"
        "😼  :smirk_cat:"
        "😽  :kissing_cat:"
        "🙀  :scream_cat:"
        "😿  :crying_cat_face:"
        "😾  :pouting_cat:"
        "💋  :kiss:"
        "👋  :wave:"
        "🤚  :raised_back_of_hand:"
        "🖐️  :hand_with_fingers_splayed:"
        "✋  :raised_hand:"
        "🤞  :crossed_fingers:"
        "🖖  :vulcan_salute:"
        "🤟  :love_you_gesture:"
        "🤘  :metal:"
        "🤙  :call_me_hand:"
        "👈  :point_left:"
        "👉  :point_right:"
        "👆  :point_up_2:"
        "🖕  :middle_finger:"
        "👇  :point_down:"
        "☝️  :point_up:"
        "👍  :thumbs_up:"
        "👎  :thumbs_down:"
        "✊  :fist_raised:"
        "👊  :fist_oncoming:"
        "🤛  :fist_left:"
        "🤜  :fist_right:"
        "👏  :clap:"
        "🙌  :raised_hands:"
        "👐  :open_hands:"
        "🤲  :palms_up_together:"
        "🤝  :handshake:"
        "🙏  :pray:"
        "✍️  :writing_hand:"
        "💅  :nail_care:"
        "🤳  :selfie:"
        "💪  :muscle:"
        "🦵  :leg:"
        "🦶  :foot:"
        "👂  :ear:"
        "🦻  :ear_with_hearing_aid:"
        "👃  :nose:"
        "🧠  :brain:"
        "🦷  :tooth:"
        "🦴  :bone:"
        "👀  :eyes:"
        "👁️  :eye:"
        "👅  :tongue:"
        "👄  :lips:"
        "👶  :baby:"
        "🧒  :child:"
        "👦  :boy:"
        "👧  :girl:"
        "🧑  :adult:"
        "👱  :blond_haired_person:"
        "👨  :man:"
        "👩  :woman:"
        "🧓  :older_adult:"
        "👴  :older_man:"
        "👵  :older_woman:"
        "🙍  :frowning_person:"
        "🙍‍♂️  :frowning_man:"
        "🙍‍♀️  :frowning_woman:"
        "🙎  :pouting_person:"
        "🙎‍♂️  :pouting_man:"
        "🙎‍♀️  :pouting_woman:"
        "🙅  :gesturing_no:"
        "🙅‍♂️  :man_gesturing_no:"
        "🙅‍♀️  :woman_gesturing_no:"
        "🙆  :gesturing_ok:"
        "🙆‍♂️  :man_gesturing_ok:"
        "🙆‍♀️  :woman_gesturing_ok:"
        "🙆‍♂️  :man_gesturing_ok:"
        "🙆‍♀️  :woman_gesturing_ok:"
        "🙋  :raising_hand:"
        "🙋‍♂️  :man_raising_hand:"
        "🙋‍♀️  :woman_raising_hand:"
        "🧏  :deaf_person:"
        "🧏‍♂️  :deaf_man:"
        "🧏‍♀️  :deaf_woman:"
        "🙇  :bowing_person:"
        "🙇‍♂️  :man_bowing:"
        "🙇‍♀️  :woman_bowing:"
        "🤦  :person_facepalming:"
        "🤦‍♂️  :man_facepalming:"
        "🤦‍♀️  :woman_facepalming:"
        "🤷  :person_shrugging:"
        "🤷‍♂️  :man_shrugging:"
        "🤷‍♀️  :woman_shrugging:"
        "🧑‍⚕️  :health_worker:"
        "👨‍⚕️  :man_health_worker:"
        "👩‍⚕️  :woman_health_worker:"
        "🧑‍🎓  :student:"
        "👨‍🎓  :man_student:"
        "👩‍🎓  :woman_student:"
        "🧑‍🏫  :teacher:"
        "👨‍🏫  :man_teacher:"
        "👩‍🏫  :woman_teacher:"
        "🧑‍⚖️  :judge:"
        "👨‍⚖️  :man_judge:"
        "👩‍⚖️  :woman_judge:"
        "🧑‍🌾  :farmer:"
        "👨‍🌾  :man_farmer:"
        "👩‍🌾  :woman_farmer:"
        "🧑‍🍳  :cook:"
        "👨‍🍳  :man_cook:"
        "👩‍🍳  :woman_cook:"
        "🧑‍🔧  :mechanic:"
        "👨‍🔧  :man_mechanic:"
        "👩‍🔧  :woman_mechanic:"
        "🧑‍🏭  :factory_worker:"
        "👨‍🏭  :man_factory_worker:"
        "👩‍🏭  :woman_factory_worker:"
        "🧑‍💼  :office_worker:"
        "👨‍💼  :man_office_worker:"
        "👩‍💼  :woman_office_worker:"
        "🧑‍🔬  :scientist:"
        "👨‍🔬  :man_scientist:"
        "👩‍🔬  :woman_scientist:"
        "🧑‍💻  :technologist:"
        "👨‍💻  :man_technologist:"
        "👩‍💻  :woman_technologist:"
        "🧑‍🎤  :singer:"
        "👨‍🎤  :man_singer:"
        "👩‍🎤  :woman_singer:"
        "🧑‍🎨  :artist:"
        "👨‍🎨  :man_artist:"
        "👩‍🎨  :woman_artist:"
        "🧑‍✈️  :pilot:"
        "👨‍✈️  :man_pilot:"
        "👩‍✈️  :woman_pilot:"
        "🧑‍🚀  :astronaut:"
        "👨‍🚀  :man_astronaut:"
        "👩‍🚀  :woman_astronaut:"
        "🧑‍🚒  :firefighter:"
        "👨‍🚒  :man_firefighter:"
        "👩‍🚒  :woman_firefighter:"
        "👮  :police_officer:"
        "👮‍♂️  :man_police_officer:"
        "👮‍♀️  :woman_police_officer:"
        "🕵️  :detective:"
        "🕵️‍♂️  :man_detective:"
        "🕵️‍♀️  :woman_detective:"
        "💂  :guard:"
        "💂‍♂️  :man_guard:"
        "💂‍♀️  :woman_guard:"
        "👷  :construction_worker:"
        "👷‍♂️  :man_construction_worker:"
        "👷‍♀️  :woman_construction_worker:"
        "🤴  :prince:"
        "👸  :princess:"
        "👳  :person_wearing_turban:"
        "👳‍♂️  :man_wearing_turban:"
        "👳‍♀️  :woman_wearing_turban:"
        "👲  :man_with_gua_pi_mao:"
        "🧕  :woman_with_headscarf:"
        "🤵  :man_in_tuxedo:"
        "👰  :bride_with_veil:"
        "🤰  :pregnant_woman:"
        "🤱  :breast_feeding:"
        "👼  :angel:"
        "🎅  :santa:"
        "🤶  :mrs_claus:"
        "🦸  :superhero:"
        "🦸‍♂️  :man_superhero:"
        "🦸‍♀️  :woman_superhero:"
        "🦹  :supervillain:"
        "🦹‍♂️  :man_supervillain:"
        "🦹‍♀️  :woman_supervillain:"
        "🧙  :mage:"
        "🧙‍♂️  :man_mage:"
        "🧙‍♀️  :woman_mage:"
        "🧚  :fairy:"
        "🧚‍♂️  :man_fairy:"
        "🧚‍♀️  :woman_fairy:"
        "🧛  :vampire:"
        "🧛‍♂️  :man_vampire:"
        "🧛‍♀️  :woman_vampire:"
        "🧜  :merperson:"
        "🧜‍♂️  :merman:"
        "🧜‍♀️  :mermaid:"
        "🧝  :elf:"
        "🧝‍♂️  :man_elf:"
        "🧝‍♀️  :woman_elf:"
        "🧞  :genie:"
        "🧞‍♂️  :man_genie:"
        "🧞‍♀️  :woman_genie:"
        "🧟  :zombie:"
        "🧟‍♂️  :man_zombie:"
        "🧟‍♀️  :woman_zombie:"
        "💆  :person_getting_massage:"
        "💆‍♂️  :man_getting_massage:"
        "💆‍♀️  :woman_getting_massage:"
        "💇  :person_getting_haircut:"
        "💇‍♂️  :man_getting_haircut:"
        "💇‍♀️  :woman_getting_haircut:"
        "🚶  :person_walking:"
        "🚶‍♂️  :man_walking:"
        "🚶‍♀️  :woman_walking:"
        "🧍  :person_standing:"
        "🧍‍♂️  :man_standing:"
        "🧍‍♀️  :woman_standing:"
        "🧎  :person_kneeling:"
        "🧎‍♂️  :man_kneeling:"
        "🧎‍♀️  :woman_kneeling:"
        "🧑‍🦯  :person_with_probing_cane:"
        "👨‍🦯  :man_with_probing_cane:"
        "👩‍🦯  :woman_with_probing_cane:"
        "🧑‍🦼  :person_in_motorized_wheelchair:"
        "👨‍🦼  :man_in_motorized_wheelchair:"
        "👩‍🦼  :woman_in_motorized_wheelchair:"
        "🧑‍🦽  :person_in_manual_wheelchair:"
        "👨‍🦽  :man_in_manual_wheelchair:"
        "👩‍🦽  :woman_in_manual_wheelchair:"
        "🏃  :person_running:"
        "🏃‍♂️  :man_running:"
        "🏃‍♀️  :woman_running:"
        "💃  :woman_dancing:"
        "🕺  :man_dancing:"
        "🕴️  :man_in_suit_levitating:"
        "👯  :people_with_bunny_ears_partying:"
        "👯‍♂️  :men_with_bunny_ears_partying:"
        "👯‍♀️  :women_with_bunny_ears_partying:"
        "🧖  :person_in_steamy_room:"
        "🧖‍♂️  :man_in_steamy_room:"
        "🧖‍♀️  :woman_in_steamy_room:"
        "🧘  :person_in_lotus_position:"
        "🧑‍🤝‍🧑  :people_holding_hands:"
        "👭  :women_holding_hands:"
        "👫  :woman_and_man_holding_hands:"
        "👬  :men_holding_hands:"
        "💏  :kiss:"
        "👩‍❤️‍💋‍👨  :woman_kiss_man:"
        "👨‍❤️‍💋‍👨  :man_kiss_man:"
        "👩‍❤️‍💋‍👩  :woman_kiss_woman:"
        "💑  :couple_with_heart:"
        "👩‍❤️‍👨  :woman_heart_man:"
        "👨‍❤️‍👨  :man_heart_man:"
        "👩‍❤️‍👩  :woman_heart_woman:"
        "👪  :family:"
        "👨‍👩‍👦  :family_man_woman_boy:"
        "👨‍👩‍👧  :family_man_woman_girl:"
        "👨‍👩‍👧‍👦  :family_man_woman_girl_boy:"
        "👨‍👩‍👦‍👦  :family_man_woman_boy_boy:"
        "👨‍👩‍👧‍👧  :family_man_woman_girl_girl:"
        "👨‍👨‍👦  :family_man_man_boy:"
        "👨‍👨‍👧  :family_man_man_girl:"
        "👨‍👨‍👧‍👦  :family_man_man_girl_boy:"
        "👨‍👨‍👦‍👦  :family_man_man_boy_boy:"
        "👨‍👨‍👧‍👧  :family_man_man_girl_girl:"
        "👩‍👩‍👦  :family_woman_woman_boy:"
        "👩‍👩‍👧  :family_woman_woman_girl:"
        "👩‍👩‍👧‍👦  :family_woman_woman_girl_boy:"
        "👩‍👩‍👦‍👦  :family_woman_woman_boy_boy:"
        "👩‍👩‍👧‍👧  :family_woman_woman_girl_girl:"
        "👨‍👦  :family_man_boy:"
        "👨‍👦‍👦  :family_man_boy_boy:"
        "👨‍👧  :family_man_girl:"
        "👨‍👧‍👦  :family_man_girl_boy:"
        "👨‍👧‍👧  :family_man_girl_girl:"
        "👩‍👦  :family_woman_boy:"
        "👩‍👦‍👦  :family_woman_boy_boy:"
        "👩‍👧  :family_woman_girl:"
        "👩‍👧‍👦  :family_woman_girl_boy:"
        "👩‍👧‍👧  :family_woman_girl_girl:"
        "👚  :womans_clothes:"
        "👕  :shirt:"
        "👖  :jeans:"
        "🩳  :shorts:"
        "👔  :necktie:"
        "👗  :dress:"
        "👙  :bikini:"
        "🩱  :one_piece_swimsuit:"
        "👘  :kimono:"
        "🩴  :sandal:"
        "👡  :high_heel:"
        "👢  :boot:"
        "👞  :mans_shoe:"
        "👟  :athletic_shoe:"
        "🥾  :hiking_boot:"
        "🥿  :flat_shoe:"
        "👠  :high_heel:"
        "👡  :sandal:"
        "🥿  :flat_shoe:"
        "🩰  :ballet_shoes:"
        "👑  :crown:"
        "👒  :womans_hat:"
        "🎩  :top_hat:"
        "🎓  :graduation_cap:"
        "🧢  :billed_cap:"
        "🪖  :military_helmet:"
        "💄  :lipstick:"
        "💍  :ring:"
        "💼  :briefcase:"
        "🩸  :drop_of_blood:"
        "🧽  :sponge:"
        "🧼  :soap:"
        "🪥  :toothbrush:"
        "🧴  :lotion_bottle:"
        "🌂  :closed_umbrella:"
        "☂️  :umbrella:"
        "🎒  :school_satchel:"
        "👝  :pouch:"
        "👛  :purse:"
        "👜  :handbag:"
        "💰  :money_bag:"
        "🪙  :coin:"
        "💳  :credit_card:"
        "🧾  :receipt:"
        "🏧  :atm:"
        "🪝  :hook:"
        "🛍️  :shopping_cart:"
        "🛒  :shopping_cart:"
        "🎁  :gift:"
        "🎈  :balloon:"
        "🎏  :flags:"
        "🎀  :ribbon:"
        "🎊  :confetti_ball:"
        "🎉  :tada:"
        "🧨  :firecracker:"
        "🎎  :dolls:"
        "🔦  :flashlight:"
        "🏮  :red_paper_lantern:"
        "🪔  :diya_lamp:"
        "🧧  :red_envelope:"
        "✉️  :envelope:"
        "📩  :envelope_with_arrow:"
        "📨  :incoming_envelope:"
        "📧  :e-mail:"
        "💌  :love_letter:"
        "📥  :inbox_tray:"
        "📤  :outbox_tray:"
        "📦  :package:"
        "🏷️  :label:"
        "📪  :mailbox_closed:"
        "📫  :mailbox:"
        "📬  :mailbox_with_mail:"
        "📭  :mailbox_with_no_mail:"
        "📮  :postbox:"
        "📯  :postal_horn:"
        "📜  :scroll:"
        "📃  :page_with_curl:"
        "📄  :page_facing_up:"
        "📑  :bookmark_tabs:"
        "🧾  :receipt:"
        "📊  :bar_chart:"
        "📈  :chart_with_upwards_trend:"
        "📉  :chart_with_downwards_trend:"
        "🗒️  :spiral_notepad:"
        "🗓️  :spiral_calendar:"
        "📆  :calendar:"
        "📅  :date:"
        "🗑️  :wastebasket:"
        "📇  :card_index:"
        "🗃️  :card_file_box:"
        "🗳️  :ballot_box:"
        "🗄️  :file_cabinet:"
        "📋  :clipboard:"
        "📁  :file_folder:"
        "📂  :open_file_folder:"
        "🗂️  :card_index_dividers:"
        "📰  :newspaper:"
        "📓  :notebook:"
        "📔  :notebook_with_decorative_cover:"
        "📒  :ledger:"
        "📕  :closed_book:"
        "📗  :green_book:"
        "📘  :blue_book:"
        "📙  :orange_book:"
        "📚  :books:"
        "📖  :book:"
        "🔖  :bookmark:"
        "🧷  :safety_pin:"
        "🔗  :link:"
        "📎  :paperclip:"
        "🖇️  :paperclips:"
        "📐  :triangular_ruler:"
        "📏  :straight_ruler:"
        "🧮  :abacus:"
        "📌  :pushpin:"
        "📍  :round_pushpin:"
        "✂️  :scissors:"
        "🖊️  :pen:"
        "🖋️  :fountain_pen:"
        "✒️  :black_nib:"
        "🖌️  :paintbrush:"
        "🖍️  :crayon:"
        "📝  :memo:"
        "✏️  :pencil2:"
        "🔍  :mag:"
        "🔎  :mag_right:"
    )

    local emoji=$(printf "%s\n" "${list[@]}" | wofi --dmenu --prompt "<EMOJI-MENU>" | cut -d ' ' -f 1 | tr -d '\n')
    echo $emoji
}

# Main function to handle emoji parameters
main() {
    if requirements; then
    local emoji=$(menu)

        if [[ -n $emoji ]]; then
            printf $emoji | wl-copy
            notify-send -u normal -a "Emoji Selected" "$emoji"
        else
            notify-send -u normal -a "Emoji Selected" "🙅 NONE"
        fi
    fi

    cleanup
}

# Start of the script
main
